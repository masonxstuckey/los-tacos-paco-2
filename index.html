// Email Signup Popup
window.onload = function () {
    document.getElementById("emailPopup").style.display = "flex";
};

function closePopup() {
    document.getElementById("emailPopup").style.display = "none";
}

function subscribe() {
    const email = document.getElementById("emailInput").value;
    if (email) {
        alert("Thank you for subscribing! Enjoy your free drink with your next meal.");
        closePopup();
    } else {
        alert("Please enter a valid email.");
    }
}

// Chip Game Logic with Try Again Feature
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let chips = [];
let score = 0;
let gameOver = false;
const bowl = { x: 160, width: 80, height: 20, color: "#d32f2f" };

class Chip {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.size = 20;
        this.color = "#FFD700";
    }

    draw() {
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.moveTo(this.x, this.y);
        ctx.lineTo(this.x + this.size / 2, this.y + this.size);
        ctx.lineTo(this.x - this.size / 2, this.y + this.size);
        ctx.closePath();
        ctx.fill();
    }

    fall() {
        this.y += 3;
    }
}

function drawBowl() {
    ctx.fillStyle = bowl.color;
    ctx.fillRect(bowl.x, canvas.height - bowl.height, bowl.width, bowl.height);
}

function generateChip() {
    if (!gameOver) {
        const x = Math.random() * (canvas.width - 20) + 10;
        chips.push(new Chip(x, 0));
    }
}

function updateGame() {
    if (gameOver) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    drawBowl();

    chips.forEach((chip, index) => {
        chip.fall();
        chip.draw();

        // Check if chip is caught by the bowl
        if (
            chip.y + chip.size > canvas.height - bowl.height &&
            chip.x > bowl.x &&
            chip.x < bowl.x + bowl.width
        ) {
            score++;
            chips.splice(index, 1); // Remove caught chip
            document.getElementById("gameMessage").innerText = `Score: ${score}`;

            // Win condition
            if (score >= 10) {
                alert("Congratulations! You've won free queso!");
                resetGame();
            }
        }

        // End game if chip falls past the bowl
        if (chip.y > canvas.height) {
            gameOver = true;
            document.getElementById("gameMessage").innerText = "Try Again!";
            setTimeout(resetGame, 2000); // Restart after 2 seconds
        }
    });
}

function resetGame() {
    chips = [];
    score = 0;
    gameOver = false;
    document.getElementById("gameMessage").innerText = "Score: 0";
}

function startGame() {
    resetGame();
    setInterval(updateGame, 30);
    setInterval(generateChip, 1000);
}

// Mouse control for bowl
canvas.addEventListener("mousemove", (e) => {
    bowl.x = e.offsetX - bowl.width / 2;

    // Keep the bowl within canvas boundaries
    if (bowl.x < 0) bowl.x = 0;
    if (bowl.x + bowl.width > canvas.width) bowl.x = canvas.width - bowl.width;
});
